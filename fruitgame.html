<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fruit Slots ‚Äì 5x4 1024 Cara</title>

  <!-- BAGIAN CSS -->
  <style>
    :root{--bg:#1b5e20;--gold:#f7c33e;--gap-size:12px;--rows:4;}
    body {
      margin: 0;
      background: url("https://api.imghippo.com/files/zJwC4021OSg.jpg") no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    body.scatter-mode {
      background: url("https://e0.pxfuel.com/wallpapers/597/442/desktop-wallpaper-gold-coins-gold-bullion.jpg") no-repeat center center fixed;
      background-size: cover;
    }
    .hud{display:flex;align-items:center;justify-content:center;gap:16px;margin:10px auto;}
    .pill{display:flex;flex-direction:column;align-items:center;background:rgba(0,0,0,0.7);border:1px solid #fff3;padding:6px 12px;border-radius:12px;min-width:100px;}
    .label{font-size:0.85rem;opacity:0.8;}
    #balance{font-size:1rem;font-weight:bold;color:#ffd700;}
    #win{font-size:1rem;font-weight:bold;color:#00ffcc;}
    .turbo-btn{background:#ff4444;color:#fff;border:none;border-radius:8px;padding:8px 14px;cursor:pointer;font-weight:bold;box-shadow:0 3px 0 #aa2222;}
    .turbo-btn.active{background:#00c851;box-shadow:0 3px 0 #007e33;}
    .multis{display:flex;gap:14px;justify-content:center;padding:10px;width:100%;max-width:860px;background:linear-gradient(180deg,#9c6b3d 0%, #7a4c26 100%);}
    .multi{min-width:56px;text-align:center;font-weight:900;color:#ffd77a;background:linear-gradient(180deg,#7a4c26,#5b3317);padding:6px 10px;border-radius:10px}
    .multi.active{background:linear-gradient(180deg,#f7b733,#e09f1a);color:#fff}
    .wrap{width:100%;max-width:860px;margin:10px auto;padding:16px;}
    .board{border-radius:16px;padding:14px;background:linear-gradient(180deg,#111 0%, #000 50%, #111 100%);display:grid;grid-template-columns:repeat(5,1fr);gap:var(--gap-size);width:100%;max-width:420px;aspect-ratio:5/4;border:3px solid var(--gold);box-shadow:0 0 12px #f7c33e80 inset,0 0 16px #f7c33e80;}
    .reel{display:flex;flex-direction:column;overflow:hidden;border-radius:10px;}
    .symbols{display:flex;flex-direction:column;gap:var(--gap-size)}
    .tile{flex:none;width:100%;aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;font-size:2.4rem;}
    .tile.wild{text-shadow:0 0 8px #0ff,0 0 16px #0ff}
    .tile.scatter{text-shadow:0 0 8px #ff0,0 0 16px #ff0}
    .highlight{animation:glowWin 0.8s ease-in-out infinite alternate}
    @keyframes glowWin{from{transform:scale(1);filter:drop-shadow(0 0 6px gold)}to{transform:scale(1.2);filter:drop-shadow(0 0 12px gold)}}
    .explode{animation:explodeAnim 0.6s forwards}
    @keyframes explodeAnim{0%{transform:scale(1);opacity:1}50%{transform:scale(1.5);opacity:0.8}100%{transform:scale(0);opacity:0}}
    .fall{transform:translateY(-150%);animation:fallAnim 0.4s ease forwards}
    @keyframes fallAnim{to{transform:translateY(0)}}
    .spinning{animation:scrollLoop 0.3s linear infinite}
    @keyframes scrollLoop{0%{transform:translateY(-100%)}100%{transform:translateY(0)}}
    .banner{text-align:center;font-weight:bold;margin:12px auto;width:100%;max-width:720px;background:linear-gradient(180deg,gold,#00ccff);padding:10px;border-radius:12px;color:#ffe7a1}
    .controls{display:flex;gap:20px;margin:10px auto;}
    .stats-col{display:flex;flex-direction:column;align-items:center;}
    .spin-container {position:fixed;bottom:60px;left:50%;transform:translateX(-50%);}
    .btn-spin {cursor:pointer;width:80px;height:80px;border-radius:50%;font-size:1.5rem;font-weight:bold;color:#fff;background:radial-gradient(circle at 30% 30%, red 0%, blue 70%);box-shadow:0 8px 0 red;}
    .overlay-win{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;flex-direction:column;align-items:center;justify-content:center;color:#ffd700;font-size:2rem;font-weight:bold;z-index:999;opacity:0;pointer-events:none;transition:opacity 0.6s;}
    .overlay-win.show{opacity:1;pointer-events:auto;}
  </style>
</head>
<body>

  <div class="hud">
    <div class="pill"><span class="label">Saldo</span><span id="balance">Rp. 100.000</span></div>
    <button id="turboBtn" class="turbo-btn">TURBO: OFF</button>
    <div class="pill"><span class="label">Menang</span><span id="win">Rp. 0</span></div>
  </div>

  <div class="multis">
    <div class="multi active">x1</div><div class="multi">x2</div><div class="multi">x3</div><div class="multi">x5</div>
  </div>

  <div class="wrap">
    <div class="board" id="board"></div>
    <div class="banner" id="banner">CARI 4 LONCENG UNTUK SCATTER</div>
    <div class="controls">
      <div class="stats-col">
        <span class="label">Auto Spin</span>
        <div>
          <button id="autoMinus">-</button>
          <span id="autoCount">0</span>
          <button id="autoPlus">+</button>
        </div>
      </div>
    </div>
  </div>

  <div class="spin-container"><button class="btn-spin" id="spinBtn">SPIN</button></div>
  <div class="overlay-win" id="overlayWin"><div>ANDA MEMENANGKAN</div><div id="overlayAmount">RP. 0</div></div>

  <!-- BAGIAN JS GAME -->
  <script>
    const COLS=5, ROWS=4;
    const FRUITS=["üçí","üçã","üçä","üçâ","üçá","üçì","üçç","üçè","üçé","ü•≠","üçå","ü••","üçà","‚≠ê","üîî"];
    const PAYTABLE={"üçí":0.5,"üçã":0.5,"üçä":0.5,"üçâ":1,"üçá":1,"üçì":1,"üçç":2,"üçè":3,"üçé":2,"ü•≠":3,"üçå":4,"ü••":5,"üçà":5,"‚≠ê":10};

    let balance=100000, bet=500, win=0, spinning=false;
    let cascadeCount=0, currentMulti=1;
    let autoSpinValue=0, autoSpinCount=0;
    let turbo=false;

    const balEl=document.getElementById("balance"),
          winEl=document.getElementById("win"),
          spinBtn=document.getElementById("spinBtn"),
          turboBtn=document.getElementById("turboBtn"),
          board=document.getElementById("board"),
          autoMinus=document.getElementById("autoMinus"),
          autoPlus=document.getElementById("autoPlus"),
          autoCount=document.getElementById("autoCount");

    function formatRupiah(num){ return new Intl.NumberFormat("id-ID").format(num); }
    function updateStats(){ balEl.textContent="Rp. "+formatRupiah(balance); winEl.textContent="Rp. "+formatRupiah(win); }
    function updateAutoLabel(){ autoCount.textContent=autoSpinValue; }

    function makeTile(fruit,c,r){
      const tile=document.createElement("div");
      tile.className="tile";
      tile.textContent=fruit;
      tile.dataset.c=c; tile.dataset.r=r;
      if(fruit==="‚≠ê") tile.classList.add("wild");
      if(fruit==="üîî") tile.classList.add("scatter");
      return tile;
    }

    for(let c=0;c<COLS;c++){
      const reel=document.createElement("div"); reel.className="reel"; reel.id="reel"+c;
      const container=document.createElement("div"); container.className="symbols";
      for(let r=0;r<ROWS;r++){ container.appendChild(makeTile(FRUITS[Math.floor(Math.random()*FRUITS.length)],c,r)); }
      reel.appendChild(container); board.appendChild(reel);
    }

    function calculateWin(matrix){
      let totalWin=0, highlights=[];
      for(const fruit of FRUITS){
        let count=0,reelsMatched=[];
        for(let c=0;c<COLS;c++){
          let matches=[];
          matrix[c].forEach((f,r)=>{ if(f===fruit||f==="‚≠ê"){ matches.push({c,r}); } });
          if(matches.length>0){ count++; reelsMatched.push(matches); } else break;
        }
        if(fruit!=="üîî"&&count>=3){
          const base=PAYTABLE[fruit]||1;
          totalWin += bet*base*count/10;
          reelsMatched.flat().forEach(pos=>highlights.push(pos));
        }
      }
      return {totalWin,highlights};
    }

    async function cascade(matrix){
      while(true){
        const result=calculateWin(matrix);
        if(result.highlights.length===0) break;
        win+=result.totalWin; balance+=result.totalWin; updateStats();

        result.highlights.forEach(pos=>{
          const tile=document.querySelector(`.tile[data-c="${pos.c}"][data-r="${pos.r}"]`);
          if(tile) tile.classList.add("explode");
        });
        await new Promise(r=>setTimeout(r,600));

        for(const pos of result.highlights){ matrix[pos.c][pos.r]=null; }
        for(let c=0;c<COLS;c++){
          let col=matrix[c].filter(v=>v!==null);
          while(col.length<ROWS){ col.unshift(FRUITS[Math.floor(Math.random()*FRUITS.length)]); }
          matrix[c]=col;
        }
        for(let c=0;c<COLS;c++){
          const container=document.getElementById("reel"+c).querySelector(".symbols");
          container.innerHTML="";
          for(let r=0;r<ROWS;r++){ container.appendChild(makeTile(matrix[c][r],c,r)); }
        }
        await new Promise(r=>setTimeout(r,400));
      }
    }

    async function spin(){
      if(spinning) return; if(balance<bet) return;
      spinning=true; balance-=bet; win=0; updateStats();
      let matrix=[];

      for(let c=0;c<COLS;c++){
        const container=document.getElementById("reel"+c).querySelector(".symbols");
        container.innerHTML="";
        for(let i=0;i<(turbo?30:80);i++){
          container.appendChild(makeTile(FRUITS[Math.floor(Math.random()*FRUITS.length)],c,i%ROWS));
        }
        container.classList.add("spinning");
      }

      await new Promise(r=>setTimeout(r,turbo?400:1000));

      for(let c=0;c<COLS;c++){
        const container=document.getElementById("reel"+c).querySelector(".symbols");
        container.classList.remove("spinning");
        container.innerHTML="";
        matrix[c]=[];
        for(let r=0;r<ROWS;r++){
          const fruit=FRUITS[Math.floor(Math.random()*FRUITS.length)];
          matrix[c][r]=fruit;
          container.appendChild(makeTile(fruit,c,r));
        }
      }

      await cascade(matrix);
      spinning=false;
      if(autoSpinCount>0){ autoSpinCount--; setTimeout(spin,turbo?400:1200); }
    }

    spinBtn.addEventListener("click",()=>{
      if(spinning) return;
      if(autoSpinCount>0){ autoSpinCount=0; spinBtn.textContent="SPIN"; return; }
      if(autoSpinValue>0){ autoSpinCount=autoSpinValue; spinBtn.textContent="STOP"; }
      spin();
    });

    turboBtn.addEventListener("click",()=>{ turbo=!turbo; turboBtn.textContent="TURBO: "+(turbo?"ON":"OFF"); turboBtn.classList.toggle("active"); });
    autoMinus.addEventListener("click",()=>{ if(autoSpinValue>0) autoSpinValue--; updateAutoLabel(); });
    autoPlus.addEventListener("click",()=>{ autoSpinValue++; updateAutoLabel(); });

    updateStats(); updateAutoLabel();
  </script>

  <!-- BAGIAN FIREBASE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB8g9X_En_sJnbdT_Rc1NK88dUdbg3y2nE",
      authDomain: "fruit-game-5e4a8.firebaseapp.com",
      projectId: "fruit-game-5e4a8",
      storageBucket: "fruit-game-5e4a8.appspot.com",
      messagingSenderId: "936228678997",
      appId: "1:936228678997:web:9dab2fa0d9a019161bd3dc"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    let currentUser=null;

    async function loadBalance(uid){
      const ref=doc(db,"users",uid);
      const snap=await getDoc(ref);
      if(snap.exists()){ balance=snap.data().saldo||100000; }
      else{ balance=100000; await setDoc(ref,{saldo:balance}); }
      updateStats();
    }
    async function saveBalance(uid){ await setDoc(doc(db,"users",uid),{saldo:balance},{merge:true}); }

    window.updateGameBalance=async function(newBal){ balance=newBal; updateStats(); if(currentUser) await saveBalance(currentUser.uid); }

    onAuthStateChanged(auth,async(user)=>{ if(user){ currentUser=user; await loadBalance(user.uid); } else { window.location.href="index.html"; } });
  </script>
</body>
    </html>
